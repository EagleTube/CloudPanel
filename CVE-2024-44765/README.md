# Proof of Concept (PoC) for Cloudpanel [Improper Authorization or Access Control Misconfiguration / CVE-2024-44765]

## üìñ Introduction
> An Improper Authorization (Access Control Misconfiguration) vulnerability in MGT-COMMERCE GmbH CloudPanel v2.0.0 to v2.4.2 allows low-privilege users to bypass access controls and gain unauthorized access to sensitive configuration files and administrative functionality.
> <br> [!] Low-privilege users can directly modify their vhost configurations, potentially accessing and exposing sensitive data or altering critical settings that should only be accessible to administrators. [!]

---

## üîç Overview

- **Researcher:** [Your Name](https://github.com/EagleTube)
- **CVE ID:** CVE-2024-44765
- **Vulnerability Type:** Improper Authorization or Access Control Misconfiguration
- **Affected Products:** v2.0.0 - 2.4.2
- **Severity:** High
- **Fix Available:** No

---

## üõ†Ô∏è Technical Details

A detailed technical description of the vulnerability, including:
- The root cause of this issue when user are not restrict modifying vhost nginx configuration
- The vulnerability occur when attacker which have low privilege manipulate the nginx configuration by change its document root to main cloudpanel document root
- After change the root folder in nginx configuration , attacker could download .env and .sq3 sqlite file in main clp directory
- Its more impactable when user could also download ssh key , /etc/shadow and many sensitive local file

## üö®Post Exploitation
- Data Breach
- Admin Account Take Over
- Secret Key Exposure
- Web Shell upload
- Privilege Escalation

### Vulnerability Documentation:

- This vulnerability require at least lower privileges in cloudpanel, follow this step to achieve the CRLF injection

1. **Step 1**: Access the cloudpanel with your user:

2. **Step 2**: Click manage and go to vhost:

3. **Step 3**: Put hashtag before {{root}}:

4. **Step 4**: Insert new root below it (Exploit cloudpanel itself, you also can put any directory you want).

    4.1 **Step 4.1**: Leak secret token.
        ```
        root /home/clp/htdocs/app/files
        ```
   
    4.2 **Step 4.2**: Leak sqlite database.
        ```
        root /home/clp/htdocs/app/data
        ```
   
5. **Step 5**: Save the configuration and open your website and your root directory have change now you just put .env or db.sq3.
   ```
   https://yourdomain.my/.env | https://yourdomain.my/db.sq3
   ```
